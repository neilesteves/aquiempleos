!function($){$.fn.extend({custom_autocomplete:function(options){var ctxt,firstParent,functions,methods,secondParent,st,tplSuggestedList;return functions={ctxt:null,eEvaluateValue:function(e){var ubicacion;return ubicacion=$.trim(ctxt.busqueda.val()),ubicacion===ctxt.cacheTxtUbicacion?!1:13===e.keyCode||9===e.keyCode||void 0===e.keyCode?!1:(ctxt.cacheTxtUbicacion=ubicacion,functions.fnVerifyXhr(),functions.fnVerifyToken(),void(ubicacion.length<=st.numLettersToStart?(functions.fnHideCurrentResults(),functions.fnHideLoadingBox(),functions.fnAfterCleanSearch(),functions.fnCleanHiddenValue()):(functions.fnCleanHiddenValue(),functions.fnShowLoadingBox(),functions.fnShowCurrentResults(),functions.fnBeforeSendRequest(),functions.fnFinishTyping(functions.fnStartConsultUbigeo,850))))},eUpdateText:function(e){var id,newValueSelected,option,value;clearTimeout(ctxt.timer),ctxt.box.addClass(st.classHide),ctxt.box.html(""),option=$(e.currentTarget),newValueSelected=$.trim(option.data("value")),value=""!==newValueSelected?newValueSelected:$.trim(option.html()),ctxt.busqueda.val(value),id=null,null!==ctxt.hiddenValue&&(id=option.data("id"),ctxt.hiddenValue.val(id)),functions.fnAfterUpdateText(value,id),functions.fnVerifyXhr(),functions.fnVerifyToken(),functions.fnHideCurrentResults(),functions.fnHideLoadingBox()},eCleanSearch:function(e){clearTimeout(ctxt.timer),setTimeout(function(){functions.fnVerifyXhr(),functions.fnVerifyToken(),functions.fnHideCurrentResults(),functions.fnHideLoadingBox()},500)},fnStartConsultUbigeo:function(){ctxt.needToken?st.getTokenAjax(functions.fnGetResultsFromSearchValue,functions.fnShowErrorFromServer):functions.fnGetResultsFromSearchValue("noToken")},fnGetResultsFromSearchValue:function(token){var dataToSend,txtSearch;txtSearch=ctxt.busqueda.val().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\+/g,"&#43;").replace(/\*/g,"&#42;").replace(/\?/g,"&#63;"),functions.fnVerifyXhr(),dataToSend=functions.fnPrepareData(token,txtSearch),ctxt.xhr=$.ajax({type:st.typeAjax,url:st.urlAutocomplete,data:dataToSend}).done(function(response){var result;return result=jQuery.parseJSON(response),ctxt.busqueda.is(":focus")===!1?!1:0===result.status?(functions.fnStartConsultUbigeo(),!1):result.items===[]?!1:(functions.fnRender(result.items),void functions.fnShowCurrentResults())}).always(function(){functions.fnHideLoadingBox(),functions.fnAfterSendRequest()})},fnPrepareData:function(token,value){return{csrfhash:token,value:value}},fnRender:function(result){var li,notData,txtSearch;li="",notData="",result.length>0?(txtSearch=ctxt.busqueda.val(),txtSearch=txtSearch.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\+/g,"&#43;").replace(/\*/g,"&#42;").replace(/\?/g,"&#63;"),$.each(result,function(key,value){var matches,text;text=value.mostrar,matches=value.mostrar.match(new RegExp(txtSearch,"ig")),null!==matches&&(matches=$.unique(matches),text=functions.fnAddClassMatch(matches,value.mostrar)),li+="<li class='autocomplete_option' data-id='"+value.id+"' data-value='"+value.mostrar+"'>"+text+"</li>"})):(notData="not_data",li="<li>No se encontraron resultados para su b√∫squeda</li>"),ctxt.box.html("<ul class='"+notData+"'>"+li+"</lu>")},fnAddClassMatch:function(matches,text){var newText;return newText=text,$.each(matches,function(index,match){newText=newText.replace(new RegExp(match,"g"),"<b>"+match+"</b>")}),newText=newText.replace(new RegExp("<b>","g"),"<b class='autocomplete_match_text'>")},fnAfterUpdateText:function(value,id){},fnShowErrorFromServer:function(){functions.fnStartConsultUbigeo()},fnCleanHiddenValue:function(){null!==ctxt.hiddenValue&&ctxt.hiddenValue.val("")},fnBeforeSendRequest:function(){},fnAfterSendRequest:function(){},fnShowLoadingBox:function(){ctxt.busqueda.attr("loading","")},fnHideLoadingBox:function(){ctxt.busqueda.removeAttr("loading")},fnShowCurrentResults:function(){""!==ctxt.box.html()&&ctxt.box.removeClass(st.classHide)},fnHideCurrentResults:function(){ctxt.box.addClass(st.classHide),ctxt.box.html("")},fnAfterCleanSearch:function(){},fnVerifyXhr:function(){ctxt.xhr&&ctxt.xhr.abort()},fnVerifyToken:function(){},fnFinishTyping:function(callback,ms){null!==ctxt.timer&&clearTimeout(ctxt.timer),ctxt.timer=setTimeout(callback,ms)}},ctxt={},st=$.extend({hiddenValue:null,urlAutocomplete:null,getTokenAjax:null,parentBoxClass:"autocomplete_widget",boxClass:"autocomplete_result",inputContainer:"autocomplete_container",optionElement:"autocomplete_option",typeAjax:"POST",responseError:"Acceso denegado",classHide:"hide",fnPrepareData:functions.fnPrepareData,fnRender:functions.fnRender,fnBeforeSendRequest:functions.fnBeforeSendRequest,fnAfterSendRequest:functions.fnAfterSendRequest,fnAfterUpdateText:functions.fnAfterUpdateText,fnAfterCleanSearch:functions.fnAfterCleanSearch,eUpdateText:functions.eUpdateText,numLettersToStart:2,needToken:!0},options),firstParent=$(this).parent(),secondParent=firstParent.parent(),firstParent.addClass(st.inputContainer),tplSuggestedList="<div class=' "+st.boxClass+" hide'></div>",$(tplSuggestedList).insertAfter(firstParent),secondParent.addClass(st.parentBoxClass),this.each(function(){ctxt.parentBox=$(this).closest("."+st.widget),ctxt.xhr=null,ctxt.cacheTxtUbicacion=null,ctxt.box=secondParent.find("."+st.boxClass),ctxt.busqueda=$(this),ctxt.timer=null,ctxt.needToken=st.needToken,functions.fnRender=st.fnRender,functions.fnAfterUpdateText=st.fnAfterUpdateText,functions.eUpdateText=st.eUpdateText,functions.fnBeforeSendRequest=st.fnBeforeSendRequest,functions.fnPrepareData=st.fnPrepareData,functions.fnAfterSendRequest=st.fnAfterSendRequest,functions.fnAfterCleanSearch=st.fnAfterCleanSearch,functions.eEvaluateValue=functions.eEvaluateValue,null!==ctxt.hiddenValue&&(ctxt.hiddenValue=$(st.hiddenValue)),functions.ctxt=ctxt,$(this).bind("input keyup",$.proxy(functions.eEvaluateValue,ctxt)),secondParent.on("click","."+st.optionElement,$.proxy(functions.eUpdateText,ctxt)),$(this).on("focusout",$.proxy(functions.eCleanSearch,ctxt))}),methods={fnAbortXHR:function(){$.proxy(functions.fnVerifyXhr,null),$.proxy(functions.fnVerifyToken,null),$.proxy(functions.fnHideCurrentResults,null),$.proxy(functions.fnHideLoadingBox,null)}}}})}(jQuery);