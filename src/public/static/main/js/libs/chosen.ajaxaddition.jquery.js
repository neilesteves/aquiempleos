var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};!function($){"use strict";var arrayRemove;arrayRemove=function(from,to){var rest;return rest=this.slice((to||from)+1||this.length),this.length=0>from?this.length+from:from,this.push.apply(this,rest)},$.fn.ajaxChosen=function(ajaxOptions,options,chosenOptions){var callback,chosen,input,inputBG,keyRight,loadingImg,minLength,processValue,requestQueue,select,throttle,typing;return select=$(this),chosen=void 0,keyRight=void 0,input=void 0,inputBG=void 0,callback=void 0,throttle=!1,requestQueue=[],typing=!1,loadingImg="/img/loading.gif",minLength=1,processValue=function(e){var field,q;return field=$(this),q=field.val(),"paste"===e.type&&field.is(":not(:focus)")||e.which&&(9===e.which||13===e.which||16===e.which||17===e.which||18===e.which||19===e.which||20===e.which||27===e.which||33===e.which||34===e.which||35===e.which||36===e.which||37===e.which||38===e.which||39===e.which||40===e.which||44===e.which||45===e.which||144===e.which||145===e.which||91===e.which||93===e.which||224===e.which||e.which>=112&&e.which<=123)?!1:indexOf.call(options,"useAjax")>=0&&$.isFunction(options.useAjax)&&!options.useAjax(e)?!1:($(".no-results",chosen).hide(),$.trim(q).length<minLength?(input.get(0).style.background=inputBG,throttle&&clearTimeout(throttle),!1):(typing=!0,$.isArray(ajaxOptions.data)?("q"===ajaxOptions.data[ajaxOptions.data.length-1].name&&ajaxOptions.data.pop(),ajaxOptions.data=ajaxOptions.data.concat({name:"q",value:q})):(indexOf.call(ajaxOptions,"data")>=0||(ajaxOptions.data={}),$.extend(ajaxOptions.data,{data:{q:q}})),indexOf.call(options,"generateUrl")>=0&&$.isFunction(options.generateUrl)&&(ajaxOptions.url=options.generateUrl(q)),input.get(0).style.background='transparent url("'+loadingImg+'") no-repeat right 3px',throttle&&clearTimeout(throttle),void(throttle=setTimeout(function(){requestQueue.push(q),typing=!1,$.ajax(ajaxOptions)},700))))},0===$("option",select).length&&select.append('<option value=""></option>'),chosenOptions?select.chosen(chosenOptions):select.chosen(),chosen=select.next(),input=$("input",chosen),inputBG=input.get(0)?input.get(0).style.background:"",indexOf.call(ajaxOptions,"success")>=0&&$.isFunction(ajaxOptions.success)&&(callback=ajaxOptions.success),ajaxOptions.success=function(data,textStatus,jqXHR){var inputEmptied,inputEmptiedValue,items,keep,old,requestQueueLength,selected,valuesArray,valuesHash;if(items=data,selected=void 0,valuesArray=void 0,valuesHash={},requestQueueLength=requestQueue.length,old=!1,keep=!1,inputEmptied=!1,inputEmptiedValue="",typing)return requestQueue.shift(),!1;if(requestQueueLength>1){if($.each(requestQueue,function(idx,elem){return data.q===elem?(idx!==requestQueueLength-1?(old=!0,arrayRemove.call(requestQueue,idx)):(keep=!0,requestQueue.length=0),!1):void 0}),old||!keep)return!1}else if("undefined"==typeof requestQueue.shift())return!1;if(inputEmptiedValue=$.trim(input.val()),inputEmptied=inputEmptiedValue.length<minLength,indexOf.call(options,"processItems")>=0&&$.isFunction(options.processItems))items=options.processItems(data);else{if(!(indexOf.call(items,"results")>=0))return!1;items=items.results}selected=$("option:selected",select).not(":empty").clone().attr("selected",!0),valuesArray=$.isArray(select.val())?select.val():[select.val()],$.each(valuesArray,function(i,value){valuesHash[value]=1}),$("option",select).remove(),$('<option value=""/>').appendTo(select),selected.appendTo(select),inputEmptied||($.isArray(items)?$.each(items,function(i,opt){"undefined"==typeof valuesHash[opt.id]&&$('<option value="'+opt.id+'">'+opt.text+"</option>").appendTo(select)}):$.each(items,function(value,text){"undefined"==typeof valuesHash[value]&&$('<option value="'+value+'">'+text+"</option>").appendTo(select)})),select.trigger("chosen:updated"),keyRight=$.Event("keyup"),keyRight.which=39,input.val(inputEmptied?inputEmptiedValue:data.q).trigger(keyRight).get(0).style.background=inputBG,items.length>0?$(".no-results",chosen).hide():$(".no-results",chosen).show(),callback&&callback(data,textStatus,jqXHR)},options||(options={}),indexOf.call(options,"loadingImg")>=0&&(loadingImg=options.loadingImg),indexOf.call(options,"minLength")>=0&&(minLength=options.minLength),$(".chosen-search > input, .chosen-choices .search-field input",chosen).bind("keyup",processValue).bind("paste",function(e){var that;that=this,setTimeout(function(){processValue.call(that,e)},50)}),select}}(jQuery);